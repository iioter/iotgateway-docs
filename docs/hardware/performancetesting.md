---
sidebar_position: 4
title: 5.4 性能测试
---

## 背景

对于衡量网关的采集性能的指标，业内是**没有**具体的**标准**和**规范**的。

数据采集的**效率**受**网络情况**、**设备数量**、**每个设备的采集变量数**、设备配置的**采集周期**等影响。

本次测试根据以往**项目经验**下进行，尽量**覆盖常规的使用场景**。

## 结论

硬件采用**IIoT-B100**型号的**硬件网关**，搭载最新版本**v0.8.1**版本的**网关程序**。

采集**100台**设备，每台设备**100**个变量，共**10,000**变量，**所有设备**都实现了**1.1秒**的采集周期。

此时网关**CPU**占用**36%**，**内存**消耗**253M**，可见**软硬件性能**都有**很丰富的的余量**。

持续运行**8小时**后，cpu、内存基本**无波动**，**cpu温度**控制在**47.7℃**左右。
:::info

> **千元级**的网关中运行，能达到这样的性能是**非常满意**的。

:::


## 测试环境
测试环境搭建如下图，共准备1台网关、2台PC。
```

                                         
                                       +------- PC1 ------+            +------- PC2 ------+
                                       |                  |            |                  |
                                       | +---- Emqx ----+ |-)))wifi(((-| +-- MQTT.fx ---+ |
               +--- IIoT-B100 ---+     |-|   mqttBroker | |            |-|   mqttClient | |
               |                 |     | +--------------+ |            | +--------------+ |
               | +-iotgateway--+ |     |                  |            |                  |
               | |  mqttclient |-|     | +--- ModSim1---+ |            +------------------+
     ---WAN--- | |             | |-LAN-+-|10.10.0.11:502| |
               | | modbusMaster|-|     | +--------------+ |
               | +-------------+ |     |                  |
               |   10.10.0.10    |     | +--- ModSim-n--+ |
               +-----------------+     |-|10.10.0.11:506| |
                                       | +--------------+ |
                                       |                  |
                                       +------------------+
```
其中:
- **IIoT-B100**网关运行**采集**程序，并将数据**推送**到PC1的**emqx**服务器。

- **PC1**运行5个**Modsim**，模拟modbusTcp从站设备。

- **PC2**运行**MQTT.fx客户端**，**随机**订阅一台设备数据，**持续监控消息数量和时间**。

## 测试结果

|设备数	 |变量总数	|总CPU	|程序内存   |各设备周期	 |设定周期|
|-----	|--------  |---	   |-----	  |-----	   |-------|
|1      |1	       |16%	   |217M	  |0.37ms	   |0 |
|1	    |50	       |14%	   |242M      |15.16ms	   |0 |
|1	    |100	   |14%	   |236M	  |31.38ms	   |0 |
|1	    |500	   |11%	   |260M	  |136.46ms	   |0 |
|10	    |5000	   |45%	   |233M	  |350.67ms	   |0 |
|20	    |1000	   |77%	   |280M	  |547.36ms	   |0 |
|30	    |15000	   |80%	   |305M	  |1.059s	   |0 |
|31	    |3100	   |13%	   |254M	  |1.262s	   |1s |
|50	    |5000	   |16%	   |237M	  |1.362s	   |1s |
|100	|10000	   |36%	   |253M	  |1.096s	   |1s |

## 测试报告
测试报告源文件可以点这里
[下载excel](../../static/files/测试报告-iotgateway+iiot-b100.xlsx)